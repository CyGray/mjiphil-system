I need your help adding a system to connect an img to the products when we add a product. When adding,
we can click the img url input to open the file explorer to upload a photo, then it will be added to
./assets/products/img/{name}.{ext png|jpg|jpeg|webp if possible|svg if possible}, and the 
URL will be added to the database.


If you need access to other files, do ask for it. Never assume contents of a file.

## ğŸ“ Folder Structure

```
â”œâ”€ alter_order_item.py
â”œâ”€ analysis.md
â”œâ”€ auth_check.php
â”œâ”€ catalog.php
â”œâ”€ config.php
â”œâ”€ dashboard.php
â”œâ”€ index.html
â”œâ”€ inventory.php
â”œâ”€ login.php
â”œâ”€ menu.php
â”œâ”€ prompt.txt
â”œâ”€ register.php
â”œâ”€ api
â”‚  â”œâ”€ cart.php
â”‚  â”œâ”€ login.php
â”‚  â””â”€ order.php
â”œâ”€ data
â”‚  â”œâ”€ JsonDataManager.php
â”‚  â””â”€ products.json
â”œâ”€ assets
â”‚  â”œâ”€ AngleGrndr.png
â”‚  â”œâ”€ banner.png
â”‚  â”œâ”€ banner2.png
â”‚  â”œâ”€ BTuffHollowBlock.png
â”‚  â”œâ”€ DuraCoreHelm.png
â”‚  â”œâ”€ nobg-logo.png
â”‚  â”œâ”€ ProBuildCement.png
â”‚  â”œâ”€ QuickSeal.png
â”‚  â”œâ”€ ReadyMConcrete.png
â”‚  â”œâ”€ SteelRebar16mm.png
â”‚  â””â”€ VoltMaxCordDrill.png
â”œâ”€ logs
â”‚  â”œâ”€ cart-api.log
â”‚  â”œâ”€ login.log
â”‚  â””â”€ order-api.log
â”œâ”€ scripts
â”‚  â”œâ”€ add_product.php
â”‚  â”œâ”€ catalog.js
â”‚  â”œâ”€ components.js
â”‚  â”œâ”€ delete_item.php
â”‚  â”œâ”€ inventory.js
â”‚  â”œâ”€ login.js
â”‚  â”œâ”€ logout.php
â”‚  â”œâ”€ main.js
â”‚  â”œâ”€ products.js
â”‚  â”œâ”€ register.js
â”‚  â””â”€ session_check.js
â”œâ”€ utils
â”‚  â”œâ”€ setup.php
â”‚  â””â”€ setup_database.php
â”œâ”€ styles
â”‚  â”œâ”€ catalog.css
â”‚  â”œâ”€ components.css
â”‚  â”œâ”€ dashboard.css
â”‚  â”œâ”€ inventory.css
â”‚  â”œâ”€ login.css
â”‚  â””â”€ register.css
â””â”€ backups
   â”œâ”€ api
   â”‚  â”œâ”€ cart.php
   â”‚  â””â”€ login.php
   â””â”€ logs
      â””â”€ cart-api.log


// inventory.php

<?php
require_once 'auth_check.php';
checkAdminAccess();
require_once 'config.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['add_item'])) {
        $category_id = $_POST['category_id'] ?? '';
        $product_name = trim($_POST['product_name'] ?? '');
        $description = trim($_POST['description'] ?? '');
        $price = $_POST['price'] ?? '';
        $stock_quantity = $_POST['stock_quantity'] ?? '';
        $image_url = trim($_POST['image_url'] ?? '');

        try {
            // Start transaction
            $pdo->beginTransaction();

            // Insert into product table
            $stmt = $pdo->prepare("INSERT INTO product (category_id, product_name, description, price) VALUES (?, ?, ?, ?)");
            $stmt->execute([$category_id, $product_name, $description, $price]);
            $product_id = $pdo->lastInsertId();

            // Insert into inventory table
            $stmt = $pdo->prepare("INSERT INTO inventory (product_id, stock_quantity) VALUES (?, ?)");
            $stmt->execute([$product_id, $stock_quantity]);

            // Insert image if provided
            if (!empty($image_url)) {
                $stmt = $pdo->prepare("INSERT INTO product_image (product_id, image_url) VALUES (?, ?)");
                $stmt->execute([$product_id, $image_url]);
            }

            // Get category name for JSON
            $catStmt = $pdo->prepare("SELECT category_name FROM category WHERE category_id = ?");
            $catStmt->execute([$category_id]);
            $category = $catStmt->fetch();

            // Save to JSON
            $jsonProduct = [
                'product_name' => $product_name,
                'description' => $description,
                'price' => (float)$price,
                'stock_quantity' => (int)$stock_quantity,
                'category' => $category['category_name'],
                'image_url' => $image_url
            ];
            
            $jsonManager->addProduct($jsonProduct);

            $pdo->commit();
            $_SESSION['success'] = "Item added successfully!";
        } catch (PDOException $e) {
            $pdo->rollBack();
            $_SESSION['error'] = "Error adding item: " . $e->getMessage();
        }
        
        header("Location: inventory.php");
        exit;
    }
}

// Get categories for dropdown
$categories = ["Tools", "Materials"];
try {
    $stmt = $pdo->query("SELECT category_id, category_name FROM category ORDER BY category_name");
    $categories = $stmt->fetchAll();
} catch (PDOException $e) {
    $_SESSION['error'] = "Error loading categories: " . $e->getMessage();
}

// Get inventory items with search, filter, and sort
$search = $_GET['search'] ?? '';
$category_filter = $_GET['category'] ?? '';
$type_filter = $_GET['type'] ?? '';
$sort_by = $_GET['sort'] ?? 'product_id';
$sort_order = $_GET['order'] ?? 'asc';

// Build query
$query = "SELECT p.product_id, p.product_name, p.description, p.price, 
                 c.category_name, i.stock_quantity,
                 pi.image_url,
                 COALESCE(SUM(oi.quantity), 0) as monthly_sales
          FROM product p
          LEFT JOIN category c ON p.category_id = c.category_id
          LEFT JOIN inventory i ON p.product_id = i.product_id
          LEFT JOIN product_image pi ON p.product_id = pi.product_id
          LEFT JOIN order_item oi ON p.product_id = oi.product_id
          LEFT JOIN `order` o ON oi.order_id = o.order_id AND o.order_date >= DATE_SUB(NOW(), INTERVAL 30 DAY)
          WHERE 1=1";

$params = [];

// Add search filter
if (!empty($search)) {
    $query .= " AND (p.product_name LIKE ? OR p.description LIKE ?)";
    $search_term = "%$search%";
    $params[] = $search_term;
    $params[] = $search_term;
}

// Add category filter
if (!empty($category_filter)) {
    $query .= " AND p.category_id = ?";
    $params[] = $category_filter;
}

// Add type filter (if you have a type field)
if (!empty($type_filter)) {
    $query .= " AND c.category_name = ?";
    $params[] = $type_filter;
}

// Group by and order by
$query .= " GROUP BY p.product_id ORDER BY $sort_by $sort_order";

try {
    $stmt = $pdo->prepare($query);
    $stmt->execute($params);
    $inventory_items = $stmt->fetchAll();
} catch (PDOException $e) {
    $_SESSION['error'] = "Error loading inventory: " . $e->getMessage();
    $inventory_items = [];
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory - MJI PHIL Construction</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="./styles/inventory.css" rel="stylesheet">
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">MJI</div>
            <span class="company-name">MJIPHIL CONSTRUCTION</span>
        </div>
        <div class="header-right">
            <i class="fas fa-bars menu-icon"></i>
            <form method="GET" action="inventory.php" class="search-header">
                <i class="fas fa-search"></i>
                <input type="text" name="search" placeholder="Search Products here" id="headerSearch" value="<?php echo htmlspecialchars($search); ?>">
            </form>
            <div class="filter-icon" onclick="toggleFilterModal()">
                <i class="fas fa-filter"></i>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <div class="sidebar">
            <div class="sidebar-item">
                <i class="fas fa-th-large"></i>
                <span><a href="catalog.php" style="color: inherit; text-decoration: none;">CATALOG</a></span>
            </div>
            <div class="sidebar-item active">
                <i class="fas fa-box"></i>
                <span>INVENTORY</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-lock"></i>
                <span>PRIVACY</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-cog"></i>
                <span>SERVICES</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-info-circle"></i>
                <span>ABOUT US</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-file-alt"></i>
                <span>INFORMATION</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-share-alt"></i>
                <span>SOCIAL MEDIA</span>
            </div>
            <div class="logout-section">
                <div class="logout-item" onclick="logout()">
                    <i class="fas fa-user-circle"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <?php if (isset($_SESSION['success'])): ?>
                <div class="alert alert-success">
                    <?php echo htmlspecialchars($_SESSION['success']); unset($_SESSION['success']); ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['error'])): ?>
                <div class="alert alert-danger">
                    <?php echo htmlspecialchars($_SESSION['error']); unset($_SESSION['error']); ?>
                </div>
            <?php endif; ?>

            <h1 class="page-title">INVENTORY</h1>

            <div class="controls-bar">
                <div class="controls-left">
                    <form method="GET" action="inventory.php" class="d-flex gap-2">
                        <select name="category" class="btn btn-outline" onchange="this.form.submit()">
                            <option value="">All Categories</option>
                            <?php foreach ($categories as $category): ?>
                                <option value="<?php echo $category['category_id']; ?>" <?php echo ($category_filter == $category['category_id']) ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($category['category_name']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                        <select name="type" class="btn btn-outline" onchange="this.form.submit()">
                            <option value="">All Types</option>
                            <option value="Tools" <?php echo ($type_filter == 'Tools') ? 'selected' : ''; ?>>Tools</option>
                            <option value="Materials" <?php echo ($type_filter == 'Materials') ? 'selected' : ''; ?>>Materials</option>
                            <option value="Safety Gear" <?php echo ($type_filter == 'Safety Gear') ? 'selected' : ''; ?>>Safety Gear</option>
                        </select>
                        <input type="hidden" name="search" value="<?php echo htmlspecialchars($search); ?>">
                    </form>
                </div>
                <div class="controls-right">
                    <button class="btn btn-primary" onclick="openAddModal()">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                    <button class="btn btn-outline" onclick="openBulkUpload()">
                        <i class="fas fa-upload"></i> Bulk Upload
                    </button>
                    <div class="view-toggle">
                        <button class="active">
                            <i class="fas fa-list"></i>
                        </button>
                        <button>
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortTable('product_id')">ID <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('product_name')">Item Name <i class="fas fa-sort"></i></th>
                            <th>Image</th>
                            <th onclick="sortTable('price')">Price <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('stock_quantity')">Quantity <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('monthly_sales')">Monthly Sales <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('category_name')">Category <i class="fas fa-sort"></i></th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <?php if (empty($inventory_items)): ?>
                            <tr>
                                <td colspan="9" class="text-center">No items found</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($inventory_items as $item): ?>
                                <tr>
                                    <td><?php echo htmlspecialchars($item['product_id']); ?></td>
                                    <td><?php echo htmlspecialchars($item['product_name']); ?></td>
                                    <td>
                                        <div class="item-image">
                                            <?php if (!empty($item['image_url'])): ?>
                                                <img src="<?php echo htmlspecialchars($item['image_url']); ?>" alt="<?php echo htmlspecialchars($item['product_name']); ?>" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;">
                                            <?php else: ?>
                                                <i class="fas fa-image"></i>
                                            <?php endif; ?>
                                        </div>
                                    </td>
                                    <td>PHP <?php echo number_format($item['price'], 2); ?></td>
                                    <td><?php echo htmlspecialchars($item['stock_quantity']); ?></td>
                                    <td><?php echo htmlspecialchars($item['monthly_sales']); ?></td>
                                    <td><?php echo htmlspecialchars($item['category_name']); ?></td>
                                    <td><?php echo htmlspecialchars($item['description']); ?></td>
                                    <td>
                                        <div class="action-icons">
                                            <i class="fas fa-pen" onclick="editItem(<?php echo $item['product_id']; ?>)"></i>
                                            <i class="fas fa-trash-alt" onclick="deleteItem(<?php echo $item['product_id']; ?>)"></i>
                                        </div>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal" id="addItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add an Item</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form method="POST" id="addItemForm">
                    <input type="hidden" name="add_item" value="1">
                    
                    <div class="form-group">
                        <label class="form-label">Item Name</label>
                        <input type="text" class="form-control" name="product_name" placeholder="Product name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" placeholder="Product description" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" name="price" placeholder="0.00" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <input type="number" class="form-control" name="stock_quantity" placeholder="Quantity" min="0" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-control" name="category_id" required>
                                <option value="">Select Category</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value="<?php echo $category['category_id']; ?>"><?php echo htmlspecialchars($category['category_name']); ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Image URL (optional)</label>
                            <input type="text" class="form-control" name="image_url" placeholder="Image URL">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        Add Item
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="./scripts/inventory.js"></script>
    <script>
        function sortTable(column) {
            const url = new URL(window.location.href);
            const currentSort = url.searchParams.get('sort');
            const currentOrder = url.searchParams.get('order');
            
            let newOrder = 'asc';
            if (currentSort === column && currentOrder === 'asc') {
                newOrder = 'desc';
            }
            
            url.searchParams.set('sort', column);
            url.searchParams.set('order', newOrder);
            window.location.href = url.toString();
        }

        function openAddModal() {
            document.getElementById('addItemModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('addItemModal').classList.remove('show');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'logout.php';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('addItemModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Auto-submit search when typing stops
        let searchTimeout;
        document.getElementById('headerSearch').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                this.form.submit();
            }, 500);
        });
    </script>
</body>
</html>

// scripts/inventory.js

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    // Auto-search functionality
    const searchInput = document.getElementById('headerSearch');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                this.form.submit();
            }, 500);
        });
    }

    // Add form validation
    const addItemForm = document.getElementById('addItemForm');
    if (addItemForm) {
        addItemForm.addEventListener('submit', function(e) {
            const price = this.querySelector('input[name="price"]');
            const quantity = this.querySelector('input[name="stock_quantity"]');
            
            if (parseFloat(price.value) < 0) {
                e.preventDefault();
                alert('Price cannot be negative');
                price.focus();
                return;
            }
            
            if (parseInt(quantity.value) < 0) {
                e.preventDefault();
                alert('Quantity cannot be negative');
                quantity.focus();
                return;
            }
        });
    }
});

// Sort table function
function sortTable(column) {
    const url = new URL(window.location.href);
    const currentSort = url.searchParams.get('sort');
    const currentOrder = url.searchParams.get('order');
    
    let newOrder = 'asc';
    if (currentSort === column && currentOrder === 'asc') {
        newOrder = 'desc';
    }
    
    url.searchParams.set('sort', column);
    url.searchParams.set('order', newOrder);
    window.location.href = url.toString();
}

// Modal functions
function openAddModal() {
    document.getElementById('addItemModal').classList.add('show');
}

function closeModal() {
    document.getElementById('addItemModal').classList.remove('show');
}

function editItem(productId) {
    if (confirm('Edit item ' + productId + '?')) {
        // You can implement edit functionality here
        // For now, just show a message
        alert('Edit functionality for item ' + productId + ' will be implemented soon.');
    }
}

function deleteItem(productId) {
    if (confirm('Are you sure you want to delete this item?')) {
        // You can implement delete functionality here
        fetch('delete_item.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'product_id=' + productId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Item deleted successfully');
                location.reload();
            } else {
                alert('Error deleting item: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error deleting item: ' + error);
        });
    }
}

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        window.location.href = 'logout.php';
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('addItemModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl + N to open add modal
    if (e.ctrlKey && e.key === 'n') {
        e.preventDefault();
        openAddModal();
    }
    
    // Escape to close modal
    if (e.key === 'Escape') {
        closeModal();
    }
});

// utils/setup_database.php

<?php
// Database setup and initialization script
class DatabaseSetup {
    private $pdo;
    private $db_host = '127.0.0.1';
    private $db_user = 'root';
    private $db_pass = '';
    private $db_name = 'mjiphil_catalog';
    
    public function __construct() {
        try {
            // First connect without database to create it
            $this->pdo = new PDO("mysql:host={$this->db_host}", $this->db_user, $this->db_pass, [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            ]);
        } catch (PDOException $e) {
            die("Database connection failed: " . $e->getMessage());
        }
    }
    
    public function setupDatabase() {
        try {
            // Create database
            $this->pdo->exec("CREATE DATABASE IF NOT EXISTS {$this->db_name}");
            $this->pdo->exec("USE {$this->db_name}");
            
            echo "Database created successfully.<br>";
            
            // Create tables
            $this->createTables();
            
            // Insert default data
            $this->insertDefaultData();
            
            // Sync JSON data
            $this->syncJsonData();
            
            echo "Database setup completed successfully!";
            
        } catch (PDOException $e) {
            die("Database setup failed: " . $e->getMessage());
        }
    }
    
    private function createTables() {
        $tables = [
            "CREATE TABLE IF NOT EXISTS user (
                user_id INT AUTO_INCREMENT PRIMARY KEY,
                first_name VARCHAR(100) NOT NULL,
                last_name VARCHAR(100) NOT NULL,
                email VARCHAR(255) NOT NULL UNIQUE,
                password VARCHAR(255) NOT NULL,
                phone VARCHAR(20),
                role ENUM('admin', 'regular') DEFAULT 'regular',
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
            )",
            
            "CREATE TABLE IF NOT EXISTS address (
                address_id INT AUTO_INCREMENT PRIMARY KEY,
                user_id INT NOT NULL,
                street VARCHAR(255) NOT NULL,
                city VARCHAR(100) NOT NULL,
                province VARCHAR(100) NOT NULL,
                postal_code VARCHAR(20) NOT NULL,
                is_default BOOLEAN DEFAULT FALSE,
                address_type ENUM('billing', 'shipping', 'both') DEFAULT 'both',
                FOREIGN KEY (user_id) REFERENCES user(user_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                INDEX idx_user_id (user_id)
            )",
            
            "CREATE TABLE IF NOT EXISTS category (
                category_id INT AUTO_INCREMENT PRIMARY KEY,
                category_name VARCHAR(100) NOT NULL UNIQUE,
                description TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )",
            
            "CREATE TABLE IF NOT EXISTS product (
                product_id INT AUTO_INCREMENT PRIMARY KEY,
                category_id INT NOT NULL,
                product_name VARCHAR(150) NOT NULL,
                description TEXT,
                price DECIMAL(10,2) NOT NULL,
                is_active BOOLEAN DEFAULT TRUE,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                FOREIGN KEY (category_id) REFERENCES category(category_id)
                    ON DELETE RESTRICT ON UPDATE CASCADE,
                INDEX idx_category_id (category_id),
                INDEX idx_is_active (is_active)
            )",
            
            "CREATE TABLE IF NOT EXISTS product_image (
                image_id INT AUTO_INCREMENT PRIMARY KEY,
                product_id INT NOT NULL,
                image_url VARCHAR(255) NOT NULL,
                is_primary BOOLEAN DEFAULT FALSE,
                alt_text VARCHAR(255),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (product_id) REFERENCES product(product_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                INDEX idx_product_id (product_id),
                INDEX idx_is_primary (is_primary)
            )",
            
            "CREATE TABLE IF NOT EXISTS inventory (
                inventory_id INT AUTO_INCREMENT PRIMARY KEY,
                product_id INT UNIQUE NOT NULL,
                stock_quantity INT DEFAULT 0,
                low_stock_threshold INT DEFAULT 10,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                FOREIGN KEY (product_id) REFERENCES product(product_id)
                    ON DELETE CASCADE ON UPDATE CASCADE
            )",
            
            "CREATE TABLE IF NOT EXISTS cart (
                cart_id INT AUTO_INCREMENT PRIMARY KEY,
                user_id INT NOT NULL UNIQUE,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES user(user_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                INDEX idx_user_id (user_id)
            )",
            
            "CREATE TABLE IF NOT EXISTS cart_item (
                cart_item_id INT AUTO_INCREMENT PRIMARY KEY,
                cart_id INT NOT NULL,
                product_id INT NOT NULL,
                quantity INT NOT NULL CHECK (quantity > 0),
                added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                FOREIGN KEY (cart_id) REFERENCES cart(cart_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                FOREIGN KEY (product_id) REFERENCES product(product_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                UNIQUE KEY unique_cart_product (cart_id, product_id),
                INDEX idx_cart_id (cart_id),
                INDEX idx_product_id (product_id)
            )",
            
            "CREATE TABLE IF NOT EXISTS order_status (
                order_status_id INT AUTO_INCREMENT PRIMARY KEY,
                status_name ENUM('Pending', 'Paid', 'Shipped', 'Completed', 'Cancelled') NOT NULL UNIQUE,
                description VARCHAR(255)
            )",
            
            "CREATE TABLE IF NOT EXISTS `order` (
                order_id INT AUTO_INCREMENT PRIMARY KEY,
                user_id INT NOT NULL,
                order_status_id INT NOT NULL,
                order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
                total_amount DECIMAL(10,2) NOT NULL,
                shipping_address_id INT,
                billing_address_id INT,
                notes TEXT,
                FOREIGN KEY (user_id) REFERENCES user(user_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                FOREIGN KEY (order_status_id) REFERENCES order_status(order_status_id)
                    ON DELETE RESTRICT ON UPDATE CASCADE,
                FOREIGN KEY (shipping_address_id) REFERENCES address(address_id)
                    ON DELETE SET NULL ON UPDATE CASCADE,
                FOREIGN KEY (billing_address_id) REFERENCES address(address_id)
                    ON DELETE SET NULL ON UPDATE CASCADE,
                INDEX idx_user_id (user_id),
                INDEX idx_order_date (order_date),
                INDEX idx_order_status (order_status_id)
            )",
            
            "CREATE TABLE IF NOT EXISTS order_item (
                order_item_id INT AUTO_INCREMENT PRIMARY KEY,
                order_id INT NOT NULL,
                product_id INT NOT NULL,
                quantity INT NOT NULL CHECK (quantity > 0),
                unit_price DECIMAL(10,2) NOT NULL,
                subtotal DECIMAL(10,2) NOT NULL,
                FOREIGN KEY (order_id) REFERENCES `order`(order_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                FOREIGN KEY (product_id) REFERENCES product(product_id)
                    ON DELETE RESTRICT ON UPDATE CASCADE,
                INDEX idx_order_id (order_id),
                INDEX idx_product_id (product_id)
            )",
            
            "CREATE TABLE IF NOT EXISTS payment_method (
                payment_method_id INT AUTO_INCREMENT PRIMARY KEY,
                method_name ENUM('Cash', 'GCash', 'Bank Transfer', 'Credit Card') NOT NULL UNIQUE,
                description VARCHAR(255)
            )",
            
            "CREATE TABLE IF NOT EXISTS payment (
                payment_id INT AUTO_INCREMENT PRIMARY KEY,
                order_id INT NOT NULL,
                payment_method_id INT NOT NULL,
                amount_paid DECIMAL(10,2) NOT NULL,
                payment_date DATETIME DEFAULT CURRENT_TIMESTAMP,
                payment_status ENUM('Pending', 'Confirmed', 'Refunded') DEFAULT 'Pending',
                transaction_reference VARCHAR(100),
                notes TEXT,
                FOREIGN KEY (order_id) REFERENCES `order`(order_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                FOREIGN KEY (payment_method_id) REFERENCES payment_method(payment_method_id)
                    ON DELETE RESTRICT ON UPDATE CASCADE,
                INDEX idx_order_id (order_id),
                INDEX idx_payment_date (payment_date)
            )",
            
            "CREATE TABLE IF NOT EXISTS user_payment_method (
                user_payment_id INT AUTO_INCREMENT PRIMARY KEY,
                user_id INT NOT NULL,
                payment_method_id INT NOT NULL,
                account_identifier VARCHAR(100),
                is_default BOOLEAN DEFAULT FALSE,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES user(user_id)
                    ON DELETE CASCADE ON UPDATE CASCADE,
                FOREIGN KEY (payment_method_id) REFERENCES payment_method(payment_method_id)
                    ON DELETE RESTRICT ON UPDATE CASCADE,
                INDEX idx_user_id (user_id),
                UNIQUE KEY unique_user_payment (user_id, payment_method_id, account_identifier)
            )"
        ];
        
        foreach ($tables as $tableSql) {
            $this->pdo->exec($tableSql);
        }
        
        echo "Tables created successfully.<br>";
    }
    
    private function insertDefaultData() {
        // Insert admin users
        $admins = [
            ['Roel', 'Admin', 'roel@mjiphil.com', 'cm9lbDEyMw==', 'admin'],
            ['Kyle', 'Admin', 'kyle@mjiphil.com', 'a3lsZTEyMw==', 'admin'],
            ['Wilbert', 'Admin', 'wilbert@mjiphil.com', 'd2lsYmVydDEyMw==', 'admin'],
            ['Gwen', 'Admin', 'gwen@mjiphil.com', 'Z3dlbjEyMw==', 'admin'],
            ['JC', 'Admin', 'jc@mjiphil.com', 'amMxMjM=', 'admin'],
            ['Nikolai', 'Admin', 'nikolai@mjiphil.com', 'bmlrb2xhaTEyMw==', 'admin']
        ];
        
        $stmt = $this->pdo->prepare("INSERT IGNORE INTO user (first_name, last_name, email, password, role) VALUES (?, ?, ?, ?, ?)");
        foreach ($admins as $admin) {
            $stmt->execute($admin);
        }
        
        // Insert categories
        $categories = [
            ['Tools', 'Construction tools and equipment'],
            ['Materials', 'Building and construction materials'],
            ['Safety Gear', 'Personal protective equipment'],
            ['Essentials', 'Essential construction supplies'],
            ['Electrical', 'Electrical supplies and equipment'],
            ['Plumbing', 'Plumbing materials and fixtures'],
            ['Hardware', 'Hardware and fasteners'],
            ['Paint & Supplies', 'Paints, coatings, and application tools'],
            ['Concrete & Masonry', 'Concrete, cement, and masonry supplies'],
            ['Lumber & Wood', 'Lumber, plywood, and wood products']
        ];
        
        $stmt = $this->pdo->prepare("INSERT IGNORE INTO category (category_name, description) VALUES (?, ?)");
        foreach ($categories as $category) {
            $stmt->execute($category);
        }
        
        // Insert order statuses with descriptions
        $statuses = [
            ['Pending', 'Order has been placed but not yet paid'],
            ['Paid', 'Payment has been confirmed'],
            ['Shipped', 'Order has been shipped to customer'],
            ['Completed', 'Order has been delivered and completed'],
            ['Cancelled', 'Order has been cancelled']
        ];
        
        $stmt = $this->pdo->prepare("INSERT IGNORE INTO order_status (status_name, description) VALUES (?, ?)");
        foreach ($statuses as $status) {
            $stmt->execute($status);
        }
        
        // Insert payment methods with descriptions
        $methods = [
            ['Cash', 'Cash on delivery or pickup'],
            ['GCash', 'GCash mobile payment'],
            ['Bank Transfer', 'Bank transfer or deposit'],
            ['Credit Card', 'Credit card payment']
        ];
        
        $stmt = $this->pdo->prepare("INSERT IGNORE INTO payment_method (method_name, description) VALUES (?, ?)");
        foreach ($methods as $method) {
            $stmt->execute($method);
        }
        
        echo "Default data inserted successfully.<br>";
    }
    
    private function syncJsonData() {
        $jsonFile = __DIR__ . '/data/products.json';
        if (file_exists($jsonFile)) {
            $jsonData = json_decode(file_get_contents($jsonFile), true);
            
            if (isset($jsonData['products'])) {
                $productStmt = $this->pdo->prepare("INSERT IGNORE INTO product (category_id, product_name, description, price) VALUES (?, ?, ?, ?)");
                $inventoryStmt = $this->pdo->prepare("INSERT IGNORE INTO inventory (product_id, stock_quantity) VALUES (?, ?)");
                $imageStmt = $this->pdo->prepare("INSERT IGNORE INTO product_image (product_id, image_url, is_primary) VALUES (?, ?, ?)");
                
                foreach ($jsonData['products'] as $product) {
                    // Get category ID
                    $categoryStmt = $this->pdo->prepare("SELECT category_id FROM category WHERE category_name = ?");
                    $categoryStmt->execute([$product['category']]);
                    $category = $categoryStmt->fetch();
                    
                    if ($category) {
                        $productStmt->execute([
                            $category['category_id'],
                            $product['product_name'],
                            $product['description'],
                            $product['price']
                        ]);
                        
                        $product_id = $this->pdo->lastInsertId();
                        
                        if ($product_id) {
                            $inventoryStmt->execute([$product_id, $product['stock_quantity']]);
                            
                            if (!empty($product['image_url'])) {
                                $imageStmt->execute([$product_id, $product['image_url'], TRUE]);
                            }
                        }
                    }
                }
                
                echo "JSON data synchronized successfully.<br>";
            }
        }
    }
}

// Run setup if this file is accessed directly
if (basename($_SERVER['PHP_SELF']) === 'setup_database.php') {
    $setup = new DatabaseSetup();
    $setup->setupDatabase();
}
?>